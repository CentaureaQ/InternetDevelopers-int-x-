import{d as R,r as p,a as F,z as G,c as D,e,w as t,f as s,o as q,i as H,k as c,b as u,A as J,B as K,C as W,t as m,D as X,E as C}from"./index-BM9eJQOU.js";import{h as T}from"./http-CZgcLb5a.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z=d=>T.post("/api/agents",d),ee=d=>T.get("/api/agents",{params:d}),le=d=>T.post(`/api/agents/${d}/publish`),te=(d,V)=>T.post(`/api/agents/${d}/test`,V),oe={class:"page-container"},ae={class:"flex-between"},ne={key:0,class:"test-result"},se={class:"meta"},re=R({__name:"AgentConsole",setup(d){const V=p([]),w=p(!1),P=p(!1),a=F({name:"",description:"",systemPrompt:"",userPromptTemplate:"",model:{provider:"deepseek",model:"deepseek-chat",temperature:.7,maxTokens:2048}}),A=p(!1),k=p(null),b=p(""),i=p(null),U=p(!1);async function x(){w.value=!0;try{const n=await ee({pageNo:1,pageSize:20});V.value=(n==null?void 0:n.records)||[]}catch(n){console.error("获取智能体列表失败",n)}finally{w.value=!1}}async function z(){if(!a.name||!a.systemPrompt){C.warning("请填写必要字段");return}P.value=!0;try{await Z({name:a.name,description:a.description,systemPrompt:a.systemPrompt,userPromptTemplate:a.userPromptTemplate,modelConfig:{...a.model}}),C.success("创建成功"),Object.assign(a,{name:"",description:"",systemPrompt:"",userPromptTemplate:""}),await x()}catch(n){console.error("创建智能体失败",n)}finally{P.value=!1}}function $(n){k.value=n,A.value=!0,b.value="",i.value=null}async function E(n){try{await le(n.id),C.success("发布成功"),x()}catch(l){console.error("发布失败",l)}}async function I(){if(!k.value||!b.value){C.warning("请输入测试问题");return}U.value=!0;try{const n=await te(k.value.id,{question:b.value});i.value=n}catch(n){console.error("测试失败",n)}finally{U.value=!1}}return G(()=>{x()}),(n,l)=>{const y=s("el-button"),f=s("el-input"),r=s("el-form-item"),_=s("el-col"),h=s("el-row"),B=s("el-input-number"),S=s("el-form"),M=s("el-card"),v=s("el-table-column"),j=s("el-tag"),L=s("el-table"),O=s("el-dialog"),Q=K("loading");return q(),D("div",oe,[e(M,{class:"card-container mb-16"},{header:t(()=>[u("div",ae,[l[11]||(l[11]=u("span",null,"创建智能体",-1)),e(y,{type:"primary",size:"small",onClick:x,loading:w.value},{default:t(()=>[...l[10]||(l[10]=[c("刷新列表",-1)])]),_:1},8,["loading"])])]),default:t(()=>[e(S,{model:a,"label-width":"120px",onSubmit:H(z,["prevent"])},{default:t(()=>[e(h,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(r,{label:"名称",required:""},{default:t(()=>[e(f,{modelValue:a.name,"onUpdate:modelValue":l[0]||(l[0]=o=>a.name=o),placeholder:"请输入智能体名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(r,{label:"描述"},{default:t(()=>[e(f,{modelValue:a.description,"onUpdate:modelValue":l[1]||(l[1]=o=>a.description=o),placeholder:"一句话介绍智能体"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,{label:"系统提示词",required:""},{default:t(()=>[e(f,{modelValue:a.systemPrompt,"onUpdate:modelValue":l[2]||(l[2]=o=>a.systemPrompt=o),type:"textarea",rows:4,placeholder:"描述AI的身份与能力"},null,8,["modelValue"])]),_:1}),e(r,{label:"用户模板"},{default:t(()=>[e(f,{modelValue:a.userPromptTemplate,"onUpdate:modelValue":l[3]||(l[3]=o=>a.userPromptTemplate=o),type:"textarea",rows:2,placeholder:"可选：用户消息模板"},null,8,["modelValue"])]),_:1}),e(h,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(r,{label:"模型服务商",required:""},{default:t(()=>[e(f,{modelValue:a.model.provider,"onUpdate:modelValue":l[4]||(l[4]=o=>a.model.provider=o),placeholder:"如 deepseek"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(r,{label:"模型名称",required:""},{default:t(()=>[e(f,{modelValue:a.model.model,"onUpdate:modelValue":l[5]||(l[5]=o=>a.model.model=o),placeholder:"如 deepseek-chat"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(h,{gutter:20},{default:t(()=>[e(_,{span:12},{default:t(()=>[e(r,{label:"Temperature"},{default:t(()=>[e(B,{modelValue:a.model.temperature,"onUpdate:modelValue":l[6]||(l[6]=o=>a.model.temperature=o),min:0,max:1,step:.1},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(r,{label:"Max Tokens"},{default:t(()=>[e(B,{modelValue:a.model.maxTokens,"onUpdate:modelValue":l[7]||(l[7]=o=>a.model.maxTokens=o),min:32,max:4096},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,null,{default:t(()=>[e(y,{type:"primary",loading:P.value,onClick:z},{default:t(()=>[...l[12]||(l[12]=[c("创建智能体",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(M,{class:"card-container"},{header:t(()=>[...l[13]||(l[13]=[u("span",null,"智能体列表",-1)])]),default:t(()=>[J((q(),W(L,{data:V.value,style:{width:"100%"}},{default:t(()=>[e(v,{prop:"name",label:"名称",width:"200"}),e(v,{prop:"description",label:"描述","show-overflow-tooltip":""}),e(v,{label:"模型配置",width:"200"},{default:t(({row:o})=>{var g,N;return[u("span",null,m((g=o.modelConfig)==null?void 0:g.provider)+" / "+m((N=o.modelConfig)==null?void 0:N.model),1)]}),_:1}),e(v,{prop:"status",label:"状态",width:"100"},{default:t(({row:o})=>[e(j,{type:o.status==="published"?"success":"warning"},{default:t(()=>[c(m(o.status||"draft"),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"updatedAt",label:"更新时间",width:"180"}),e(v,{label:"操作",width:"200",fixed:"right"},{default:t(({row:o})=>[e(y,{size:"small",onClick:g=>$(o)},{default:t(()=>[...l[14]||(l[14]=[c("调试",-1)])]),_:1},8,["onClick"]),e(y,{size:"small",type:"primary",disabled:o.status==="published",onClick:g=>E(o)},{default:t(()=>[...l[15]||(l[15]=[c(" 发布 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[Q,w.value]])]),_:1}),e(O,{modelValue:A.value,"onUpdate:modelValue":l[9]||(l[9]=o=>A.value=o),title:"调试智能体",width:"600px"},{default:t(()=>{var o;return[u("div",null,[u("p",null,[l[16]||(l[16]=u("strong",null,"智能体：",-1)),c(m((o=k.value)==null?void 0:o.name),1)]),e(r,{label:"测试输入"},{default:t(()=>[e(f,{modelValue:b.value,"onUpdate:modelValue":l[8]||(l[8]=g=>b.value=g),type:"textarea",rows:4,placeholder:"请填写想测试的问题"},null,8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(y,{type:"primary",loading:U.value,onClick:I},{default:t(()=>[...l[17]||(l[17]=[c("发送请求",-1)])]),_:1},8,["loading"])]),_:1}),i.value?(q(),D("div",ne,[l[18]||(l[18]=u("p",null,[u("strong",null,"AI 回复：")],-1)),u("p",null,m(i.value.reply),1),u("p",se," 耗时："+m(i.value.elapsedMs)+" ms · Tokens："+m(i.value.promptTokens)+" / "+m(i.value.completionTokens),1)])):X("",!0)])]}),_:1},8,["modelValue"])])}}}),me=Y(re,[["__scopeId","data-v-20b80308"]]);export{me as default};
