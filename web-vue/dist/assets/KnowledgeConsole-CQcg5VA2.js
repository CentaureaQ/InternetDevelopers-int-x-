import{d as Z,u as ee,r as d,a as te,l as z,z as ae,c as M,e,w as t,f as o,o as p,i as ne,k as g,b as r,F as le,G as oe,C as U,A as se,B as re,t as i,E as m,I as ue}from"./index-BM9eJQOU.js";import{h as K}from"./http-CZgcLb5a.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie=w=>K.post("/api/knowledge-bases",w),ce=()=>K.get("/api/knowledge-bases"),pe=(w,b)=>K.get(`/api/knowledge-bases/${w}/documents`,{params:{status:b}}),me={class:"page-container"},fe={class:"flex-between"},_e=["onClick"],ve={class:"flex-between"},ge={class:"kb-title"},we={class:"kb-desc"},he={class:"kb-meta"},ye={class:"flex-between"},be=Z({__name:"KnowledgeConsole",setup(w){const b=ee(),k=d(!1),x=d(!1),h=d(!1),V=d(!1),f=d([]),D=d([]),u=d(null),s=te({name:"",description:"",chunkSize:512,chunkOverlap:50}),O=z(()=>f.value.find(a=>a.id===u.value)),N=z(()=>u.value?`/api/knowledge-bases/${u.value}/documents`:""),F=z(()=>({Authorization:`Bearer ${b.token}`}));async function C(){k.value=!0;try{const a=await ce();f.value=a||[],f.value.length&&!u.value&&T(f.value[0])}catch(a){console.error("获取知识库失败",a)}finally{k.value=!1}}async function T(a){u.value=a.id,await A()}async function A(){if(u.value){V.value=!0;try{const a=await pe(u.value);D.value=a||[]}catch(a){console.error("获取文档列表失败",a)}finally{V.value=!1}}}async function E(){if(!s.name){m.warning("请填写知识库名称");return}x.value=!0;try{await ie({...s}),m.success("创建成功"),s.name="",s.description="",await C()}catch(a){console.error("创建知识库失败",a)}finally{x.value=!1}}function W(a){const n=a.type==="text/plain"||a.name.endsWith(".md")||a.name.endsWith(".txt"),_=a.size/1024/1024<10;return n?_?(h.value=!0,!0):(m.error("文件大小不能超过10MB"),!1):(m.error("仅支持TXT和Markdown格式"),!1)}async function q(a){h.value=!1,m.success("上传成功"),await A()}function G(){h.value=!1,m.error("上传失败")}function H(a){return{success:"success",processing:"warning",failed:"danger",pending:"info"}[a]||"info"}function X(a){return a?new Date(a).toLocaleString():"-"}return ae(()=>{C()}),(a,n)=>{const _=o("el-button"),I=o("el-input"),v=o("el-form-item"),c=o("el-col"),B=o("el-row"),L=o("el-input-number"),j=o("el-form"),S=o("el-card"),$=o("el-tag"),J=o("el-scrollbar"),P=o("el-upload"),y=o("el-table-column"),Q=o("el-table"),R=o("el-empty"),Y=re("loading");return p(),M("div",me,[e(S,{class:"card-container mb-16"},{header:t(()=>[r("div",fe,[n[5]||(n[5]=r("span",null,"创建知识库",-1)),e(_,{type:"primary",size:"small",onClick:C,loading:k.value},{default:t(()=>[...n[4]||(n[4]=[g("刷新",-1)])]),_:1},8,["loading"])])]),default:t(()=>[e(j,{model:s,"label-width":"120px",onSubmit:ne(E,["prevent"])},{default:t(()=>[e(B,{gutter:20},{default:t(()=>[e(c,{span:12},{default:t(()=>[e(v,{label:"名称",required:""},{default:t(()=>[e(I,{modelValue:s.name,"onUpdate:modelValue":n[0]||(n[0]=l=>s.name=l),placeholder:"知识库名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(v,{label:"描述"},{default:t(()=>[e(I,{modelValue:s.description,"onUpdate:modelValue":n[1]||(n[1]=l=>s.description=l),placeholder:"可选描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(B,{gutter:20},{default:t(()=>[e(c,{span:12},{default:t(()=>[e(v,{label:"分块大小"},{default:t(()=>[e(L,{modelValue:s.chunkSize,"onUpdate:modelValue":n[2]||(n[2]=l=>s.chunkSize=l),min:100,max:2e3},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(v,{label:"分块重叠"},{default:t(()=>[e(L,{modelValue:s.chunkOverlap,"onUpdate:modelValue":n[3]||(n[3]=l=>s.chunkOverlap=l),min:0,max:200},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(_,{type:"primary",loading:x.value,onClick:E},{default:t(()=>[...n[6]||(n[6]=[g("新建知识库",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),e(B,{gutter:20},{default:t(()=>[e(c,{span:8},{default:t(()=>[e(S,{class:"card-container"},{header:t(()=>[...n[7]||(n[7]=[r("span",null,"知识库列表",-1)])]),default:t(()=>[e(J,{height:"500px"},{default:t(()=>[(p(!0),M(le,null,oe(f.value,l=>(p(),M("div",{key:l.id,class:ue(["knowledge-item",l.id===u.value?"active":""]),onClick:ke=>T(l)},[r("div",ve,[r("div",null,[r("p",ge,i(l.name),1),r("p",we,i(l.description||"暂无描述"),1)]),e($,{type:"primary"},{default:t(()=>[g("chunk "+i(l.chunkSize)+"/"+i(l.chunkOverlap),1)]),_:2},1024)]),r("p",he,"创建于 "+i(X(l.createdAt)),1)],10,_e))),128))]),_:1})]),_:1})]),_:1}),e(c,{span:16},{default:t(()=>[O.value?(p(),U(S,{key:0,class:"card-container"},{header:t(()=>[r("div",ye,[r("span",null,"文档列表 · "+i(O.value.name),1),e(P,{action:N.value,headers:F.value,data:{knowledgeBaseId:u.value},"before-upload":W,"on-success":q,"on-error":G,"show-file-list":!1,accept:".txt,.md"},{default:t(()=>[e(_,{type:"primary",size:"small",loading:h.value},{default:t(()=>[...n[8]||(n[8]=[g("上传文档",-1)])]),_:1},8,["loading"])]),_:1},8,["action","headers","data"])])]),default:t(()=>[se((p(),U(Q,{data:D.value,style:{width:"100%"}},{default:t(()=>[e(y,{prop:"filename",label:"文件名"}),e(y,{prop:"status",label:"状态",width:"120"},{default:t(({row:l})=>[e($,{type:H(l.status)},{default:t(()=>[g(i(l.status),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"chunkCount",label:"Chunk数",width:"100"}),e(y,{prop:"uploadedAt",label:"上传时间",width:"180"})]),_:1},8,["data"])),[[Y,V.value]])]),_:1})):(p(),U(R,{key:1,description:"请选择一个知识库"}))]),_:1})]),_:1})])}}}),Be=de(be,[["__scopeId","data-v-9835dd80"]]);export{Be as default};
