# Web-Vue 前端 RAG 功能快速启动指南

## 1. 功能访问路径

### 知识库管理
- **URL**: `http://localhost:5173/knowledge`
- **菜单**: 左侧导航栏 → 知识库管理

### 创建知识库
1. 进入知识库页面
2. 点击右上角 "创建知识库" 按钮或卡片区域的 "创建新知识库"
3. 填写知识库名称、描述、访问级别、分块参数
4. 点击 "创建" 按钮

### 上传文档
1. 进入知识库详情页（点击知识库卡片）
2. 点击右上角 "上传文档" 按钮
3. 选择要上传的文件（支持多个文件）
4. 点击 "上传" 完成

### 查看文档处理状态
- 在知识库详情页的文档列表中查看
- 支持的状态：
  - **上传中** (uploading) - 黄色标签
  - **处理中** (processing) - 黄色标签
  - **已处理** (processed) - 绿色标签
  - **失败** (failed) - 红色标签

---

## 2. Agent 中的 RAG 配置

### 绑定知识库
1. 进入 Agent 编辑器页面
2. 在中间列找到 "知识库 & RAG" 配置区域
3. 从下拉框选择要绑定的知识库
4. 系统会自动加载该知识库的 RAG 配置

### 配置 RAG 参数
选中知识库后，会显示以下参数：

| 参数 | 说明 | 推荐值 |
|-----|------|-------|
| **Top-K** | 返回检索结果的数量，越大检索结果越多但可能包含无关内容 | 3-5 |
| **相似度阈值** | 0-1 之间的值，低于此阈值的结果会被过滤 | 0.6-0.7 |
| **最大上下文长度** | 传递给大模型的最大文本长度（字符数） | 2000-3000 |
| **相似度度量** | 计算相似度的方式 | cosine（推荐） |

### 保存和发布
- 配置完成后，点击 "保存草稿" 或 "发布"
- RAG 配置会自动保存到 Agent 中
- 对话时会自动使用知识库进行增强

---

## 3. 工作流示例

### 完整的 RAG 知识库 + Agent 工作流

#### 步骤 1: 创建知识库
```
导航 → 知识库管理
创建知识库 → 输入基本信息
分块参数（默认值即可）
完成 ✓
```

#### 步骤 2: 上传文档
```
进入知识库详情
上传文档 → 选择 PDF/Word/TXT 等
文档处理中... → 等待处理完成
查看文档列表 ✓
```

#### 步骤 3: 创建 RAG-增强的 Agent
```
创建 Agent → 输入名称、系统提示词、选择模型
找到 "知识库 & RAG" 配置区
选择之前创建的知识库
微调 RAG 参数（可选）
保存/发布 ✓
```

#### 步骤 4: 测试 Agent
```
在试运行面板发送问题
Agent 会自动：
  1. 从知识库中检索相关文档
  2. 将检索结果作为上下文
  3. 生成增强的回答
✓ 完成
```

---

## 4. 关键功能说明

### 知识库访问级别
- **私有 (private)**: 仅所有者可访问（推荐个人知识库）
- **受保护 (protected)**: 特定人员可访问
- **公开 (public)**: 所有人可访问

### 文档分块参数

**分块大小 (Chunk Size)**
- 默认值：800 个字符
- 说明：文本被分成多少大小的块
- 调整建议：
  - 较小 (200-500): 粒度细，适合短文本
  - 中等 (800): 平衡选择
  - 较大 (1500-2000): 粒度粗，适合长文本

**分块重叠 (Chunk Overlap)**
- 默认值：50 个字符
- 说明：相邻块之间的重叠部分，防止信息丢失
- 调整建议：一般设为分块大小的 5%-10%

### RAG 参数说明

**为什么需要 RAG 配置？**
- 不同知识库的内容质量、密度、领域不同
- 不同 Agent 的任务需求也不同
- 通过调整 RAG 参数，可以优化检索效果

**参数优化建议**

| 场景 | Top-K | 阈值 | 上下文长度 |
|-----|-------|------|----------|
| 高精度需求 | 3-5 | 0.7-0.8 | 2000-2500 |
| 通用场景 | 5-10 | 0.6-0.7 | 2000 |
| 高覆盖需求 | 10-20 | 0.5-0.6 | 3000+ |

---

## 5. 常见问题

### Q: 上传文档后为什么没有立即显示？
**A**: 文档需要经过处理流程：
- 上传 → 解析 → 分块 → 向量化 → 存储
- 通常需要几秒到几十秒
- 点击"刷新"按钮查看最新状态

### Q: RAG 配置可以随时修改吗？
**A**: 可以。修改 RAG 参数后，新的对话会使用新参数。历史对话不受影响。

### Q: 多个 Agent 可以使用同一个知识库吗？
**A**: 可以。一个知识库可以被多个 Agent 使用，节省存储空间。

### Q: 如何删除知识库中的所有文档？
**A**: 目前需要逐个删除。后续会支持批量删除。

### Q: 支持哪些文档格式？
**A**: 
- 文本格式：.txt, .md
- 文档格式：.pdf, .doc, .docx
- (具体支持的格式取决于后端配置)

---

## 6. 性能优化建议

### 知识库设置
- 不要在一个知识库中放太多小文件（建议 < 1000 个文档）
- 对于大量文档，考虑按领域/主题拆分为多个知识库

### RAG 参数
- Top-K 不宜过大（20 以上会显著增加延迟）
- 相似度阈值根据业务需求调整（不是越高越好）
- 上下文长度与模型的 token 限制相关

### 文档上传
- 大批量上传时分批进行
- 建议单个文件 < 50MB

---

## 7. 故障排查

### 知识库列表为空
- 确认已登录
- 检查是否切换了用户
- 尝试刷新页面

### 文档上传失败
- 检查文件大小和格式
- 查看错误提示信息
- 尝试重新上传

### Agent 没有使用知识库
- 确认已选择知识库
- 查看 RAG 配置是否正确保存
- 在编辑器中重新选择知识库

---

## 8. API 端点参考

所有 API 请求都需要在 Header 中包含认证信息：
```
Authorization: Bearer <token>
```

### 知识库相关
- `GET /api/v1/knowledge-bases` - 获取所有知识库
- `POST /api/v1/knowledge-bases` - 创建知识库
- `GET /api/v1/knowledge-bases/{id}` - 获取知识库详情
- `PUT /api/v1/knowledge-bases/{id}` - 更新知识库
- `DELETE /api/v1/knowledge-bases/{id}` - 删除知识库

### 文档相关
- `GET /api/v1/knowledge-bases/{uuid}/documents` - 获取文档列表
- `POST /api/v1/knowledge-bases/{uuid}/documents` - 上传文档
- `DELETE /api/v1/documents/{uuid}` - 删除文档

---

## 9. 下一步建议

1. **测试完整的 RAG 流程**
   - 创建知识库 → 上传文档 → 创建 Agent → 测试对话

2. **优化 RAG 参数**
   - 根据实际使用情况调整参数
   - 收集用户反馈，迭代改进

3. **集成到智能体对话**
   - 与后端的 RagService 对接
   - 在对话中显示引用的知识块

4. **增强用户体验**
   - 添加文档预览功能
   - 显示检索结果和相似度分数
   - 支持知识库版本管理
